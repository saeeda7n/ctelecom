---
import Basket from "../../layouts/Basket.astro";
import Steps from "../../components/basket/step-2/Steps.astro";
// import Arrow from "../../components/Basket/Arrow.astro";
// import DiscountDetials from "../../components/Basket/DiscountDetials.astro";
// import ProductListNoScroll from "../../components/Basket/ProductListNoScroll.astro";
import Header from "../../components/global/Header.astro";
import ProductList from "../../components/basket/step-1/ProductList.astro";
import DiscountDetails from "../../components/basket/step-1/DiscountDetails.astro";
import ContinueBtn from "../../components/basket/ContinueBtn.astro";
import UserData from "../../components/basket/step-1/UserData.astro";
import MapAddress from "../../components/basket/step-1/MapAddress.astro";
import AddressFullData from "../../components/basket/step-1/AddressFullData.astro";
---

<Basket>
  <Header />
  <Steps step={1} />
  <ProductList />
  <div class="text-center text-xs text-gray-400 lg:hidden">
    شما هم می توانید با امتیاز دهی به محصولات کد تخفیف دریافت کنید
  </div>

  <div class="mb-5 flex flex-col gap-5 lg:flex-row lg:gap-2">
    <div
      class="flex items-end gap-2 lg:w-8/12 lg:flex-row-reverse lg:justify-self-end"
    >
      <div class="relative flex-1">
        <input
          type="text"
          id="discount-code-input"
          placeholder="کد تخفیف"
          class="h-12 w-full rounded-full border border-transparent bg-gray-100 text-center text-sm text-black outline-none lg:h-16 lg:px-5 lg:text-right lg:text-lg"
        />
        <div
          class="absolute bottom-0 left-0 top-0 hidden w-16 items-center justify-center lg:flex"
        >
          <!--<Arrow className="border-primary" />-->
          <i class="fa-solid fa-arrow-left-long text-xl text-primary"></i>
        </div>
        <!--remove invisible to make it visible-->
        <span
          class="invisible absolute right-0 top-full mt-3 ps-5 text-right text-red-500"
        >
          کد وارد شده نامعتبر است!
        </span>
      </div>

      <DiscountDetails />
    </div>

    <div class="flex flex-shrink-0 flex-col gap-5 lg:flex-1">
      <div
        class="flex flex-col gap-3 border-b-2 border-dashed pb-5 lg:border-0 lg:pb-0"
      >
        <div
          class="hidden-discount flex items-center justify-between transition-all duration-300 lg:text-xl"
          id="discount-value"
        >
          <div
            class="font-light text-gray-400 lg:text-lg lg:font-semibold lg:text-ct-club-primary"
          >
            تخفیف
          </div>
          <div
            class="flex gap-1 font-bold text-gray-600 lg:font-semibold lg:text-ct-club-primary"
          >
            <span class="price">333,333</span>
            <span>تومان</span>
          </div>
        </div>
        <div class="flex items-center justify-between lg:hidden">
          <div class="font-light text-gray-400">جمع کل</div>
          <div class="font-bold text-gray-600">73,323 تومان</div>
        </div>
      </div>

      <div class="flex items-center justify-between lg:gap-2">
        <span
          class="font-light text-gray-400 before:content-['مجموع_پرداختی'] lg:font-medium lg:before:content-['قیمت_نهایی']"
        ></span>
        <span class="text-2xl font-bold text-gray-600">713,323,885 تومان</span>
      </div>

      <ContinueBtn />
    </div>
  </div>
  <div
    class="-mt-2 flex items-center gap-2 text-justify text-[0.6rem] text-gray-300 md:text-[0.65rem] lg:mt-0 lg:items-center lg:text-sm xl:text-[1rem] 2xl:text-[0.98rem]"
  >
    <i class="fa-regular fa-hexagon-exclamation text-xl text-primary"></i>
    بنا بر محدود بودن کالا های سی تلکام، افزودن کالا به سبد خرید به معنی رزرو آن
    محصول نیست. پس قبل از اتمام موجودی، همین حالا سبد خودتون را ثبت و خریدتون رو
    نهایی کنید
  </div>
  <hr />

  <div
    id="user-data-inputs"
    class="fixed bottom-0 left-0 right-0 top-0 z-[100] flex items-center justify-center overflow-auto bg-white/20 px-5 py-10 backdrop-blur-xl"
  >
    <div class="relative">
      <div
        class="shadow-element absolute bottom-0 left-0 right-0 top-0 rounded-3xl bg-primary"
      >
      </div>
      <div
        class="shadow-element absolute bottom-0 left-0 right-0 top-0 rounded-3xl bg-primary"
      >
      </div>
      <div
        class="relative my-auto flex w-full max-w-[22rem] flex-col gap-10 rounded-3xl border border-primary bg-white px-5 py-6"
      >
        <a href="#" class="absolute right-5 top-7 text-2xl text-gray-500">
          <i class="fa-solid fa-close"></i>
        </a>
        <form class="flex flex-col gap-10">
          <UserData />
          <!--<MapAddress />-->
          <!--<AddressFullData />-->

          <div class="flex">
            <button
              type="button"
              id="submit-btn"
              class="flex h-14 flex-1 items-center justify-center gap-5 rounded-full bg-primary pr-7 text-2xl font-semibold text-white"
            >
              بعدی
              <i class="fa-solid fa-arrow-left-long w-7"></i>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</Basket>
<style lang="scss" is:global>
  #discount-code-input.success {
    @apply border-emerald-400 bg-emerald-100 text-emerald-400 #{!important};
  }

  #discount-code-input.error ~ span {
    @apply visible #{!important};
  }

  #discount-code-input.error {
    @apply border-red-400 bg-red-100 text-red-400 #{!important};
  }

  .hidden-discount {
    @apply translate-y-10 opacity-0 #{!important};
  }

  #user-data-wrapper,
  .shadow-element {
    @apply transition-[cubic-bezier(0.645,0.045,0.355,1)];
  }

  .step-2 .shadow-element:first-child {
    @apply -translate-y-12 scale-90 opacity-90 transition-all duration-1000;
  }

  .step-3 .shadow-element:nth-child(2) {
    @apply -translate-y-12 scale-90 opacity-90 transition-all duration-1000;
  }

  .step-3 .shadow-element:first-child {
    @apply -translate-y-24 scale-[0.8] opacity-50 transition-all duration-1000;
  }

  .step-1 #user-data-wrapper {
    @apply translate-y-0 scale-100 opacity-100 transition-all duration-1000;
  }

  .step-2 #user-data-wrapper {
    @apply -translate-y-10 scale-90 opacity-0 transition-all duration-1000;
  }
</style>
<script>
  const userInputArea = $("#user-data-inputs");
  const submitBtn = userInputArea.find("#submit-btn");
  const userDataWrapper = $("#user-data-wrapper");
  const addressOnMapWrapper = $("#address-on-map-wrapper");
  const addressDetailsWrapper = $("full-address-wrapper");
  const cases = [caseOne, caseTwo, caseThree];
  userInputArea.addClass("step-1");
  let step = 1;
  submitBtn.click(function () {
    cases[step % 3]();
    step++;
  });

  function caseOne() {
    userInputArea.addClass("step-1");
    userInputArea.removeClass("step-2 step-3");
  }

  function caseTwo() {
    userInputArea.addClass("step-2");
    userInputArea.removeClass("step-1 step-3");
  }

  function caseThree() {
    userInputArea.addClass("step-3");
    userInputArea.removeClass("step-2 step-1");
  }
</script>
